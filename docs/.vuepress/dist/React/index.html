<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Redux工作流解析 | 前端打杂师 - Zhu</title>
    <meta name="description" content="All is well">
    <meta name="generator" content="VuePress 1.3.1">
    <link rel="icon" href="/vue-press/image/favicon.ico">
    
    <link rel="preload" href="/vue-press/assets/css/0.styles.309fb19c.css" as="style"><link rel="preload" href="/vue-press/assets/js/app.0a12c0b0.js" as="script"><link rel="preload" href="/vue-press/assets/js/2.391f3ac4.js" as="script"><link rel="preload" href="/vue-press/assets/js/6.1444038a.js" as="script"><link rel="prefetch" href="/vue-press/assets/js/10.2ac14e60.js"><link rel="prefetch" href="/vue-press/assets/js/11.45c1eb80.js"><link rel="prefetch" href="/vue-press/assets/js/12.2bbbadb2.js"><link rel="prefetch" href="/vue-press/assets/js/13.182945dc.js"><link rel="prefetch" href="/vue-press/assets/js/14.a284aac0.js"><link rel="prefetch" href="/vue-press/assets/js/15.5a36ac63.js"><link rel="prefetch" href="/vue-press/assets/js/16.81b7044e.js"><link rel="prefetch" href="/vue-press/assets/js/17.f395a109.js"><link rel="prefetch" href="/vue-press/assets/js/18.438a4fc6.js"><link rel="prefetch" href="/vue-press/assets/js/19.5db1fcc2.js"><link rel="prefetch" href="/vue-press/assets/js/3.557ba6eb.js"><link rel="prefetch" href="/vue-press/assets/js/4.b95a3219.js"><link rel="prefetch" href="/vue-press/assets/js/5.50c060a0.js"><link rel="prefetch" href="/vue-press/assets/js/7.3d540e6c.js"><link rel="prefetch" href="/vue-press/assets/js/8.a148e9b2.js"><link rel="prefetch" href="/vue-press/assets/js/9.9c72ef6e.js">
    <link rel="stylesheet" href="/vue-press/assets/css/0.styles.309fb19c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vue-press/" class="home-link router-link-active"><!----> <span class="site-name">前端打杂师 - Zhu</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vue-press/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/vue-press/JS/Base.html" class="nav-link">
  博客
</a></div><div class="nav-item"><a href="https://github.com/ThecoadeR/vue-press/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/vue-press/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/vue-press/JS/Base.html" class="nav-link">
  博客
</a></div><div class="nav-item"><a href="https://github.com/ThecoadeR/vue-press/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>VuePress</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>React</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vue-press/React/" class="active sidebar-link">Redux工作流解析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vue-press/React/#redux是什么" class="sidebar-link">Redux是什么</a></li><li class="sidebar-sub-header"><a href="/vue-press/React/#了解redux工作流" class="sidebar-link">了解Redux工作流</a></li><li class="sidebar-sub-header"><a href="/vue-press/React/#使用redux完成todolist" class="sidebar-link">使用Redux完成TodoList</a></li><li class="sidebar-sub-header"><a href="/vue-press/React/#加油-💯" class="sidebar-link">加油 💯</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Webpack</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Electron</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>浏览器相关</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端代码规范</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端面试</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>随手记</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="redux工作流解析"><a href="#redux工作流解析" class="header-anchor">#</a> Redux工作流解析</h1> <h2 id="redux是什么"><a href="#redux是什么" class="header-anchor">#</a> Redux是什么</h2> <p>假设我们的业务有三个嵌套的组件ABC 组件A想要传值给组件C 要先传递给组件B 交由B传递给C 在没有引入<code>Redux</code>的时候 我们只能通过这种原始的方法来传递 这时候 我们再假设 如果有一个 公共管理数据状态的地方 我们每次传递值或者修改值 都从这个地方获取 那不论业务多复杂 组件嵌套多深 我们都可以很方便的直接从这个管理仓库里 获取到我们需要的数据 这就是<code>Redux</code>  一个 <code>数据层</code>的框架 或者说是一个 <code>状态容器</code></p> <h2 id="了解redux工作流"><a href="#了解redux工作流" class="header-anchor">#</a> 了解Redux工作流</h2> <p><img src="/vue-press/assets/img/redux.4f09784d.jpg" alt=""></p> <p>这张图非常清晰的描述了 <code>Redux</code>的工作流程 光看这一张图可能会有一点晦涩难懂 但是我们可以换个说法 把整个工作流程想像成一个借书的过程</p> <p>一个人来图书馆借书 他需要说一句话告诉管理员 要借什么书 管理员要根据他提供的信息 找到对应的书籍 然后拿给他 想象过这个过程以后 再来看这个过程</p> <p>首先 <code>React Component</code>这个组件就是需要借书的人 同时<code>Store</code>就是这个图书馆的管理员 他需要告诉管理员 他要借什么书 那么这个<code>Action Creators</code>就是记录这个信息 并且告知管理员 同时管理员接收到这个信息以后 他需要查询管理手册 找到对应书籍 这个手册就对应<code>Reducers</code></p> <p>对应到实际开发到业务逻辑里 其实就是 <code>View</code> 创建了一个<code>action</code> 通过<code>dispatch</code>派发到<code>Store</code> 然后<code>Store</code>会自动转发到<code>Reducers</code> 那么Reduces就可以接收到这个action 同时根据action来处理业务逻辑 并返回给<code>Store</code> 那么接下来一起来看代码是如何实现的吧</p> <h2 id="使用redux完成todolist"><a href="#使用redux完成todolist" class="header-anchor">#</a> 使用Redux完成TodoList</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>由于讲述的是Redux 所以掠过了基础的React组件部分</p></div> <p><img src="/vue-press/assets/img/demo.f7b66080.gif" alt=""></p> <ul><li><p>安装Redux <code>npm install redux --save</code></p></li> <li><p>再一次回想流程 我们需要一个Store(图书馆管理员) 在src目录下新建一个Store文件夹 并创建<code>index.js</code>生成<code>Store</code> 接收一个<code>reducer</code>参数(对应图书馆管理员的管理手册) 有了手册才可以找到对应书籍对吧～</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// store.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span>
<span class="token keyword">import</span> reducer <span class="token keyword">from</span> <span class="token string">'./reducer.js'</span>
<span class="token keyword">const</span> Store <span class="token operator">=</span> <span class="token function">creaeStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span>
</code></pre></div></li> <li><p>上面已经提到了我们需要一个<code>reducer</code> 所以 我们新建一个<code>reducer.js</code> 同时需要注意的是<code>reducer.js</code>是一个纯函数 上文已经提到过 这个文件是一个管理手册 也就说 存放了书籍的具体信息<code>(需要被管理的数据)</code>以及如何处理书籍<code>(业务逻辑)</code></p></li> <li><p>reducer可以接收两个参数 一个是<code>action</code> 一个是<code>state</code> 默认情况下 同时可以定义一组需要被统一管理的数据 把这个需要被管理的数据赋值给state 至于<code>action</code>我们一会儿再聊</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// reducer.js</span>
<span class="token keyword">const</span> originData <span class="token operator">=</span> <span class="token punctuation">{</span>
  inputValue<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  list<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> originData<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> state
<span class="token punctuation">}</span>
</code></pre></div><ul><li>在组件内部引入<code>Store</code> 同时store提供了<code>getState()</code>这个API 可以让我们获取定义好的state 既然获取了数据 那么如果修改了数据 我们也是需要让组件知道的 所以需要使用store提供给我们的另一个API <code>subscribe</code> 这里定义的<code>handleStoreChange</code>其实只做一件事 也就是再次重新获取state</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 获取store里的数据</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./Store/'</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取数据 </span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// 组件订阅store</span>
    store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleStoreChange<span class="token punctuation">)</span> 
  <span class="token punctuation">}</span>
  <span class="token function">handleStoreChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre></div><ul><li>执行到上面那一步我们就可以在我们的业务组件中使用<code>redux</code>了 在对应业务组件中引入这个<code>Store</code> 同时我们再次回顾上问中的Redux工作流的那张图 当有了管理员<code>(store)</code> 并且有了管理手册以后<code>(reducer)</code>以后 我们现在只差一步了 也就是告诉管理员 我们需要借什么书<code>(操作什么数据)</code> 也就是组件向<code>Store</code>派发一个<code>action</code>的过程</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 组件派发action</span>

<span class="token comment">// 组件对应的绑定事件</span>
<span class="token function">handleValueChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 创建一个action type表示要做啥 value 表示需要传递的值</span>
   <span class="token keyword">const</span> action <span class="token operator">=</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token string">'change_input_value'</span><span class="token punctuation">,</span>
    value<span class="token operator">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value
  <span class="token punctuation">}</span>
  store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span> <span class="token comment">//store接收到事件以后 需要转发给reducers 交由reducers处理</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><p>当代码写到这里 回头再去看一次上文提到的比喻 看看发生了什么 首先 借书人<code>view/React Component</code>通过一句话<code>action</code>告诉了管理员<code>Store</code>要借什么书 这个时候 管理员需要查阅手册 来返回对应的书<code>newState</code> 所以我们回到reducer里看看 该怎么实现需求</p> <ul><li><p>还记得之前定义<code>reducer.js</code>的时候 reducer函数接收的参数里有<code>action</code>么 这个<code>action</code>其实就是<code>store</code>自动转发给<code>reducer</code>的 所以我们可以在<code>reducer</code>里拿到对应的<code>action</code> 并且根据action定义的type不同 处理不同的业务逻辑</p></li> <li><p>同时我们还需要注意一点 在Redux之中 真正可以修改的数据的 其实只有Store 并不是修改的方法写在reducer里 reducer就可以修改数据 所以我们需要一个返回一个新值给到Store</p></li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> originData <span class="token operator">=</span> <span class="token punctuation">{</span>
  inputValue<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  list<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token comment">//reducer.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> originData<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'change_input_value'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 返回一个新的state</span>
  <span class="token keyword">const</span> newState <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">)</span>
  newState<span class="token punctuation">.</span>inputValue <span class="token operator">=</span> action<span class="token punctuation">.</span>value
  <span class="token keyword">return</span> newState  <span class="token comment">// store会接收到这个newState 并且会把原有数据替换成该数据 真正有权修改数据的还是Store本身</span>
<span class="token punctuation">}</span>
<span class="token keyword">return</span> state
</code></pre></div><ul><li><p>写到这里 其实我们就完成了redux的初步使用 以及完整的讲解了redux的工作流程 完成了TodoList的第一个功能 顺利输入内容</p></li> <li><p>TodoList里剩下的两个功能就是 点击添加的时候 展示区域显示输入的值 以及在展示区域点击对应项 则可以删除对应项 其实也就是继续在组件内的对应函数里创建不同的action 并且在reducer里对对应的action进行处理即可</p></li> <li><p>待优化的点 可以创建<code>action creators</code> 统一管理action的创建 以及 <code>actionTypes</code>的定义 减少因为定义type时发生的拼写错误</p></li></ul> <h2 id="加油-💯"><a href="#加油-💯" class="header-anchor">#</a> 加油 💯</h2></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vue-press/Vue/Vue-base.html" class="prev">
        Vue基础之组件之间的通信
      </a></span> <span class="next"><a href="/vue-press/Webpack/">
        webpack是什么?
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/vue-press/assets/js/app.0a12c0b0.js" defer></script><script src="/vue-press/assets/js/2.391f3ac4.js" defer></script><script src="/vue-press/assets/js/6.1444038a.js" defer></script>
  </body>
</html>
